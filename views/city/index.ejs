<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
    <script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
            <link rel="stylesheet" type="text/css" href="/styles/bootstrap/css/bootstrap-theme.min.css">

        <link rel="stylesheet" type="text/css" href="/styles/bootstrap/css/bootstrap.min.css">
    <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      border:none;
      background-color: #45b1ff;
    }
    form{
      margin-right: 10px;
      margin-top: 40px;
    }
    #name {
      font-size: 1.2em;
    }

    #unit {
      font-size: 12px;
    }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-8">
              <svg viewBox="0 0 800 600"></svg>
        </div>
        <div class="col-md-4">
            <div class="row">
              <div class="col-md-12">
                <form class="form-horizontal">
                  <div class="form-group">
                    <input type="text" class="form-control" id="search" placeholder="民宿名稱" name="search">
                  </div>
                </form>
              </div>
            </div>
            <!-- 所屬縣市:<span id="name"></span><br/>
            民宿數量:<span id="density"></span><br/>
            詳細資料:<a id="city"></a><br/> -->
        </div>
      </div>
    </div>
    
  <script>
    d3.json("county.json", function(topodata) {
      var features = topojson.feature(topodata, topodata.objects["county"]).features;
      // 這裡要注意的是 topodata.objects["county"] 中的 "county" 為原本 shp 的檔名
      var path = d3.geo.path().projection( // 路徑產生器
          d3.geo.mercator().center([121,24]).scale(6000) // 座標變換函式
      );
    
      d3.select("svg").selectAll("path").data(features).enter().append("path").attr("d",path);
      var density = {};
      // var density = {
      //     "臺北市": 0, "嘉義市": 0, "新竹市": 0,
      //     "基隆市": 1, "新北市": 205, "桃園市": 28,
      //     "臺中市": 68, "彰化縣": 28, "高雄市": 56,
      //     "金門縣": 180, "臺南市": 77, "澎湖縣": 407,
      //     "雲林縣": 65, "連江縣": 93, "新竹縣": 62,
      //     "苗栗縣": 229, "屏東縣": 460, "嘉義縣": 133,
      //     "宜蘭縣": 1167, "南投縣": 549, "花蓮縣": 1516,
      //     "臺東縣": 922,
      // };

      for(idx=features.length - 1; idx >=0; idx -- ) {
          features[idx].density = density[features[idx].properties.C_Name];
      }
      var color = d3.scale.linear().domain([0,1000]).range(["#ccc","#f00"]);
          d3.select("svg").selectAll("path").data(features).attr({
            d: path,
            fill: function(d) {
              return color(d.density);
            }
          }).on("mouseover", function(d) {
            // $("#name").text(d.properties.C_Name);
            // $("#density").text(d.density);
            // $("#city").text(d.properties.C_Name);
            // $("#city").attr('href','/city/'+d.properties.C_Name+'/hostel' );
      });
    });

	$('#search').change(function(){
		var name = $(this).val();
		$.post('/hostel/search',{name:name},function(hostel){
			console.log(hostel);
			window.location = "/hostel/"+hostel.id;
		});
	});

  </script>
  </body>
</html>